<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1343px" preserveAspectRatio="none" style="width:1126px;height:1343px;" version="1.1" viewBox="0 0 1126 1343" width="1126px" zoomAndPan="magnify"><defs><filter height="300%" id="f1vfqbww2bboow" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1vfqbww2bboow)" height="260.63" style="stroke: #000000; stroke-width: 2.0;" width="877" x="73" y="246.892"/><rect fill="#FFFFFF" filter="url(#f1vfqbww2bboow)" height="83.118" style="stroke: #000000; stroke-width: 2.0;" width="440.5" x="499.5" y="273.598"/><rect fill="#FFFFFF" height="80.3939" style="stroke: none; stroke-width: 1.0;" width="877" x="73" y="427.1281"/><rect fill="#FFFFFF" filter="url(#f1vfqbww2bboow)" height="83.118" style="stroke: #000000; stroke-width: 2.0;" width="440.5" x="499.5" y="630.6401"/><rect fill="#FFFFFF" filter="url(#f1vfqbww2bboow)" height="163.512" style="stroke: #000000; stroke-width: 2.0;" width="927" x="13" y="1072.8183"/><rect fill="#FFFFFF" height="48.6879" style="stroke: none; stroke-width: 1.0;" width="927" x="13" y="1187.6423"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="48" x2="48" y1="89.0679" y2="1253.3302"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="183" x2="183" y1="89.0679" y2="1253.3302"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="576.5" x2="576.5" y1="89.0679" y2="1253.3302"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="861" x2="861" y1="89.0679" y2="1253.3302"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1024" x2="1024" y1="89.0679" y2="1253.3302"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="23" y="84.9659">Admin</text><ellipse cx="48" cy="13" fill="#FEFECE" filter="url(#f1vfqbww2bboow)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M48,21 L48,48 M35,29 L61,29 M48,48 L35,63 M48,48 L61,63 " fill="none" filter="url(#f1vfqbww2bboow)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="23" y="1267.2962">Admin</text><ellipse cx="48" cy="1281.3982" fill="#FEFECE" filter="url(#f1vfqbww2bboow)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M48,1289.3982 L48,1316.3982 M35,1297.3982 L61,1297.3982 M48,1316.3982 L35,1331.3982 M48,1316.3982 L61,1331.3982 " fill="none" filter="url(#f1vfqbww2bboow)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1vfqbww2bboow)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="197" x="83" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="183" x="90" y="72.9659">Client Application[Internal]</text><rect fill="#FEFECE" filter="url(#f1vfqbww2bboow)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="197" x="83" y="1252.3302"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="183" x="90" y="1274.2962">Client Application[Internal]</text><rect fill="#FEFECE" filter="url(#f1vfqbww2bboow)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="509.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="516.5" y="72.9659">Inventory Service</text><rect fill="#FEFECE" filter="url(#f1vfqbww2bboow)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="509.5" y="1252.3302"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="516.5" y="1274.2962">Inventory Service</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="131" x="793" y="84.9659">Inventory Database</text><path d="M843.5,34 C843.5,24 861.5,24 861.5,24 C861.5,24 879.5,24 879.5,34 L879.5,60 C879.5,70 861.5,70 861.5,70 C861.5,70 843.5,70 843.5,60 L843.5,34 " fill="#FEFECE" filter="url(#f1vfqbww2bboow)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M843.5,34 C843.5,44 861.5,44 861.5,44 C861.5,44 879.5,44 879.5,34 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="131" x="793" y="1267.2962">Inventory Database</text><path d="M843.5,1281.3982 C843.5,1271.3982 861.5,1271.3982 861.5,1271.3982 C861.5,1271.3982 879.5,1271.3982 879.5,1281.3982 L879.5,1307.3982 C879.5,1317.3982 861.5,1317.3982 861.5,1317.3982 C861.5,1317.3982 843.5,1317.3982 843.5,1307.3982 L843.5,1281.3982 " fill="#FEFECE" filter="url(#f1vfqbww2bboow)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M843.5,1281.3982 C843.5,1291.3982 861.5,1291.3982 861.5,1291.3982 C861.5,1291.3982 879.5,1291.3982 879.5,1281.3982 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#f1vfqbww2bboow)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="165" x="940" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="151" x="947" y="72.9659">Authentication Service</text><rect fill="#FEFECE" filter="url(#f1vfqbww2bboow)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="165" x="940" y="1252.3302"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="151" x="947" y="1274.2962">Authentication Service</text><rect fill="#EEEEEE" filter="url(#f1vfqbww2bboow)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1111" x="3" y="120.9209"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1114" y1="120.9209" y2="120.9209"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1114" y1="123.9209" y2="123.9209"/><rect fill="#EEEEEE" filter="url(#f1vfqbww2bboow)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="86" x="515.5" y="109.0679"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="69" x="521.5" y="126.9649">Lock Stock</text><polygon fill="#A80036" points="564.5,164.4799,574.5,168.4799,564.5,172.4799,568.5,168.4799" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="183.5" x2="570.5" y1="168.4799" y2="168.4799"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="353" x="190.5" y="162.6709">POST /inventory/lock-stock (items: [{product_id, quantity}])</text><polygon fill="#A80036" points="849.5,196.186,859.5,200.186,849.5,204.186,853.5,200.186" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="576.5" x2="855.5" y1="200.186" y2="200.186"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="583.5" y="194.377">Begin Transaction</text><polygon fill="#A80036" points="849.5,227.892,859.5,231.892,849.5,235.892,853.5,231.892" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="576.5" x2="855.5" y1="231.892" y2="231.892"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="222" x="583.5" y="226.083">Check if stock is sufficient for all items</text><path d="M73,246.892 L136,246.892 L136,255.892 L126,265.892 L73,265.892 L73,246.892 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="260.63" style="stroke: #000000; stroke-width: 2.0;" width="877" x="73" y="246.892"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="88" y="261.789">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="173" x="151" y="260.6509">[Stock is sufficient for all items]</text><path d="M499.5,273.598 L572.5,273.598 L572.5,282.598 L562.5,292.598 L499.5,292.598 L499.5,273.598 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="83.118" style="stroke: #000000; stroke-width: 2.0;" width="440.5" x="499.5" y="273.598"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="514.5" y="288.495">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="130" x="587.5" y="287.3569">[for each item in items]</text><polygon fill="#A80036" points="849.5,313.01,859.5,317.01,849.5,321.01,853.5,317.01" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="576.5" x2="855.5" y1="317.01" y2="317.01"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="583.5" y="311.201">Update stock (subtract quantity)</text><polygon fill="#A80036" points="587.5,344.716,577.5,348.716,587.5,352.716,583.5,348.716" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="581.5" x2="860.5" y1="348.716" y2="348.716"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="593.5" y="342.907">OK</text><polygon fill="#A80036" points="849.5,383.4221,859.5,387.4221,849.5,391.4221,853.5,387.4221" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="576.5" x2="855.5" y1="387.4221" y2="387.4221"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="583.5" y="381.6131">Commit Transaction</text><polygon fill="#A80036" points="194.5,415.1281,184.5,419.1281,194.5,423.1281,190.5,419.1281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="188.5" x2="575.5" y1="419.1281" y2="419.1281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="200.5" y="413.3191">Stock lock successful</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="73" x2="950" y1="428.1281" y2="428.1281"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="239" x="78" y="439.887">[Stock is insufficient for one or more items]</text><polygon fill="#A80036" points="849.5,463.816,859.5,467.816,849.5,471.816,853.5,467.816" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="576.5" x2="855.5" y1="467.816" y2="467.816"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="583.5" y="462.007">Rollback Transaction</text><polygon fill="#A80036" points="194.5,495.522,184.5,499.522,194.5,503.522,190.5,499.522" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="188.5" x2="575.5" y1="499.522" y2="499.522"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="200.5" y="493.713">Stock lock failed</text><rect fill="#EEEEEE" filter="url(#f1vfqbww2bboow)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1111" x="3" y="536.375"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1114" y1="536.375" y2="536.375"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1114" y1="539.375" y2="539.375"/><rect fill="#EEEEEE" filter="url(#f1vfqbww2bboow)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="102" x="507.5" y="524.522"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="85" x="513.5" y="542.419">Unlock Stock</text><polygon fill="#A80036" points="564.5,579.934,574.5,583.934,564.5,587.934,568.5,583.934" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="183.5" x2="570.5" y1="583.934" y2="583.934"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="369" x="190.5" y="578.125">POST /inventory/unlock-stock (items: [{product_id, quantity}])</text><polygon fill="#A80036" points="849.5,611.6401,859.5,615.6401,849.5,619.6401,853.5,615.6401" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="576.5" x2="855.5" y1="615.6401" y2="615.6401"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="583.5" y="609.831">Begin Transaction</text><path d="M499.5,630.6401 L572.5,630.6401 L572.5,639.6401 L562.5,649.6401 L499.5,649.6401 L499.5,630.6401 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="83.118" style="stroke: #000000; stroke-width: 2.0;" width="440.5" x="499.5" y="630.6401"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="514.5" y="645.5371">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="130" x="587.5" y="644.399">[for each item in items]</text><polygon fill="#A80036" points="849.5,670.0521,859.5,674.0521,849.5,678.0521,853.5,674.0521" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="576.5" x2="855.5" y1="674.0521" y2="674.0521"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="583.5" y="668.2431">Update stock (add quantity)</text><polygon fill="#A80036" points="587.5,701.7581,577.5,705.7581,587.5,709.7581,583.5,705.7581" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="581.5" x2="860.5" y1="705.7581" y2="705.7581"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="593.5" y="699.9491">OK</text><polygon fill="#A80036" points="849.5,740.4641,859.5,744.4641,849.5,748.4641,853.5,744.4641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="576.5" x2="855.5" y1="744.4641" y2="744.4641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="583.5" y="738.6551">Commit Transaction</text><polygon fill="#A80036" points="194.5,772.1701,184.5,776.1701,194.5,780.1701,190.5,776.1701" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="188.5" x2="575.5" y1="776.1701" y2="776.1701"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="200.5" y="770.3611">Stock unlock successful</text><rect fill="#EEEEEE" filter="url(#f1vfqbww2bboow)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1111" x="3" y="806.0231"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1114" y1="806.0231" y2="806.0231"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1114" y1="809.0231" y2="809.0231"/><rect fill="#EEEEEE" filter="url(#f1vfqbww2bboow)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="79" x="519" y="794.1701"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="525" y="812.0671">Get Stock</text><polygon fill="#A80036" points="564.5,849.5822,574.5,853.5822,564.5,857.5822,568.5,853.5822" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="183.5" x2="570.5" y1="853.5822" y2="853.5822"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="190.5" y="847.7732">GET /inventory/stock/{product_id}</text><polygon fill="#A80036" points="849.5,881.2882,859.5,885.2882,849.5,889.2882,853.5,885.2882" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="576.5" x2="855.5" y1="885.2882" y2="885.2882"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="583.5" y="879.4792">Get stock for product_id</text><polygon fill="#A80036" points="587.5,912.9942,577.5,916.9942,587.5,920.9942,583.5,916.9942" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="581.5" x2="860.5" y1="916.9942" y2="916.9942"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="593.5" y="911.1852">Stock quantity</text><polygon fill="#A80036" points="194.5,944.7002,184.5,948.7002,194.5,952.7002,190.5,948.7002" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="188.5" x2="575.5" y1="948.7002" y2="948.7002"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="200.5" y="942.8912">Stock quantity</text><rect fill="#EEEEEE" filter="url(#f1vfqbww2bboow)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1111" x="3" y="978.5532"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1114" y1="978.5532" y2="978.5532"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1114" y1="981.5532" y2="981.5532"/><rect fill="#EEEEEE" filter="url(#f1vfqbww2bboow)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="158" x="479.5" y="966.7002"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="141" x="485.5" y="984.5972">Update Stock (Admin)</text><polygon fill="#A80036" points="564.5,1022.1123,574.5,1026.1123,564.5,1030.1123,568.5,1026.1123" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="48" x2="570.5" y1="1026.1123" y2="1026.1123"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="301" x="55" y="1020.3032">PUT /inventory/stock/{product_id} (new_quantity)</text><polygon fill="#A80036" points="1012.5,1053.8183,1022.5,1057.8183,1012.5,1061.8183,1016.5,1057.8183" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="576.5" x2="1018.5" y1="1057.8183" y2="1057.8183"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="583.5" y="1052.0093">POST /auth/has-authority (JWT, "ADMIN")</text><path d="M13,1072.8183 L76,1072.8183 L76,1081.8183 L66,1091.8183 L13,1091.8183 L13,1072.8183 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="163.512" style="stroke: #000000; stroke-width: 2.0;" width="927" x="13" y="1072.8183"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="28" y="1087.7153">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="83" x="91" y="1086.5772">[Has authority]</text><polygon fill="#A80036" points="849.5,1112.2303,859.5,1116.2303,849.5,1120.2303,853.5,1116.2303" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="576.5" x2="855.5" y1="1116.2303" y2="1116.2303"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="261" x="583.5" y="1110.4213">Update stock for product_id (new_quantity)</text><polygon fill="#A80036" points="587.5,1143.9363,577.5,1147.9363,587.5,1151.9363,583.5,1147.9363" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="581.5" x2="860.5" y1="1147.9363" y2="1147.9363"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="593.5" y="1142.1273">OK</text><polygon fill="#A80036" points="59,1175.6423,49,1179.6423,59,1183.6423,55,1179.6423" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="53" x2="575.5" y1="1179.6423" y2="1179.6423"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="65" y="1173.8333">Stock updated successfully</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="13" x2="940" y1="1188.6423" y2="1188.6423"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="142" x="18" y="1200.4012">[Does not have authority]</text><polygon fill="#A80036" points="59,1224.3302,49,1228.3302,59,1232.3302,55,1228.3302" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="53" x2="575.5" y1="1228.3302" y2="1228.3302"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="65" y="1222.5212">Unauthorized</text><!--MD5=[cfb89f5fd56594bd3c5b91659003f6a3]
@startuml inventory-flow
actor Admin

participant "Client Application[Internal]" as Client
participant "Inventory Service" as InventorySvc
database "Inventory Database" as InventoryDB
participant "Authentication Service" as AuthService

== Lock Stock ==
Client -> InventorySvc: POST /inventory/lock-stock (items: [{product_id, quantity}])
InventorySvc -> InventoryDB: Begin Transaction

InventorySvc -> InventoryDB: Check if stock is sufficient for all items
alt Stock is sufficient for all items
    loop for each item in items
        InventorySvc -> InventoryDB: Update stock (subtract quantity)
        InventoryDB - -> InventorySvc: OK
    end
    InventorySvc -> InventoryDB: Commit Transaction
    InventorySvc - -> Client: Stock lock successful
else Stock is insufficient for one or more items
    InventorySvc -> InventoryDB: Rollback Transaction
    InventorySvc - -> Client: Stock lock failed
end

== Unlock Stock ==
Client -> InventorySvc: POST /inventory/unlock-stock (items: [{product_id, quantity}])
InventorySvc -> InventoryDB: Begin Transaction
loop for each item in items
    InventorySvc -> InventoryDB: Update stock (add quantity)
    InventoryDB - -> InventorySvc: OK
end
InventorySvc -> InventoryDB: Commit Transaction
InventorySvc - -> Client: Stock unlock successful

== Get Stock ==
Client -> InventorySvc: GET /inventory/stock/{product_id}
InventorySvc -> InventoryDB: Get stock for product_id
InventoryDB - -> InventorySvc: Stock quantity
InventorySvc - -> Client: Stock quantity

== Update Stock (Admin) ==

Admin -> InventorySvc: PUT /inventory/stock/{product_id} (new_quantity)
InventorySvc-> AuthService: POST /auth/has-authority (JWT, "ADMIN")
alt Has authority
InventorySvc -> InventoryDB: Update stock for product_id (new_quantity)
InventoryDB - -> InventorySvc: OK
InventorySvc - -> Admin: Stock updated successfully
else Does not have authority
InventorySvc - -> Admin: Unauthorized
end
@enduml

PlantUML version 1.2020.02(Sun Mar 01 15:52:07 IST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 21.0.6+7-Ubuntu-124.04.1
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>